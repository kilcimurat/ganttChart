<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fixed Task Column Gantt Chart</title>
<style>
  body {
    font-family: "Segoe UI", Arial, sans-serif;
    margin: 20px;
    background: #f8f9fb;
  }

  h2 {
    text-align: center;
    color: #003366;
    margin-bottom: 16px;
  }

  /* === Container === */
  .gantt-container {
    overflow-x: auto;
    overflow-y: auto;
    max-height: 80vh;
    border-radius: 6px;
    box-shadow: 0 0 8px rgba(0,0,0,0.1);
    background: white;
  }

  table {
    border-collapse: collapse;
    width: max-content;
    font-size: 12px;
  }

  th, td {
    border: 1px solid #d0d7e3;
    text-align: center;
    padding: 4px;
  }

  /* === Sabit boyutlar === */
  th.month, th.week { width: 70px; min-width: 70px; }
  th.year { width: 70px; min-width: 70px; }

  /* === Başlık renkleri === */
  th.year {
    background: #001f3f;
    color: white;
    font-size: 13px;
    font-weight: 700;
    position: sticky;
    top: 0;
    z-index: 3;
  }
  th.month {
    background: #005fa3;
    color: white;
    font-weight: 600;
    position: sticky;
    top: 22px;
    z-index: 2;
    white-space: nowrap;
  }
  th.week {
    background: #0074cc;
    color: #fff;
    font-weight: 500;
    position: sticky;
    top: 44px;
    z-index: 1;
    white-space: nowrap;
  }

  /* === Görev sütunu (sol sabit) === */
  td.task-name, th.task-header {
    background: #001f3f;
    color: white;
    font-weight: 700;
    text-align: left;
    padding-left: 10px;
    min-width: 150px;
    max-width: 150px;
    position: sticky;
    left: 0;
    z-index: 5;
  }
  td.task-name {
    background: #f0f4f8;
    color: #003366;
    font-weight: 600;
  }

  /* === Barlar === */
  td.bar {
    background: #00b894;
  }

  tr:hover td {
    background-color: #f8ffff;
  }
</style>
</head>
<body>

<h2>Weekly Gantt Chart (Fixed Task Column)</h2>

<div class="gantt-container">
  <table id="gantt"></table>
</div>

<script>
  // === Helper functions ===
  function getISOWeek(date) {
    const tmp = new Date(date.getTime());
    tmp.setHours(0, 0, 0, 0);
    tmp.setDate(tmp.getDate() + 3 - ((tmp.getDay() + 6) % 7));
    const week1 = new Date(tmp.getFullYear(), 0, 4);
    return 1 + Math.round(((tmp - week1) / 86400000 - 3 + ((week1.getDay() + 6) % 7)) / 7);
  }

  function getWeeksInYear(year) {
    const d = new Date(year, 11, 31);
    return getISOWeek(d) === 1 ? 52 : getISOWeek(d);
  }

  // === Generate all weeks ===
  const allWeeks = [];
  for (let year = 2025; year <= 2026; year++) { // örnek olarak 2 yıl
    const totalWeeks = getWeeksInYear(year);
    for (let w = 1; w <= totalWeeks; w++) {
      const d = new Date(year, 0, 1 + (w - 1) * 7);
      const month = d.toLocaleString("en", { month: "short" }); // Jan, Feb, ...
      allWeeks.push({ year, month, week: w });
    }
  }

  // === Tasks ===
  const tasks = [
    { name: "Design", start: "2025-W1", end: "2025-W4" },
    { name: "Backend Development", start: "2025-W6", end: "2025-W15" },
    { name: "Frontend Development", start: "2025-W10", end: "2025-W22" },
    { name: "Integration", start: "2025-W23", end: "2025-W28" },
    { name: "Testing & QA", start: "2025-W29", end: "2025-W33" },
    { name: "Release", start: "2025-W34", end: "2025-W35" }
  ];

  const table = document.getElementById("gantt");

  // === 1. Satır: Yıllar ===
  const yearRow = document.createElement("tr");
  let currentYear = null, yearSpan = 0, yearCells = "";
  allWeeks.forEach((w, i) => {
    if (w.year !== currentYear) {
      if (yearSpan > 0)
        yearCells += `<th class="year" colspan="${yearSpan}">${currentYear}</th>`;
      currentYear = w.year; yearSpan = 1;
    } else yearSpan++;
    if (i === allWeeks.length - 1)
      yearCells += `<th class="year" colspan="${yearSpan}">${currentYear}</th>`;
  });
  yearRow.innerHTML = `<th rowspan="3" class="task-header">Task</th>` + yearCells;
  table.appendChild(yearRow);

  // === 2. Satır: Aylar ===
  const monthRow = document.createElement("tr");
  let currentMonth = "", currentYearForMonth = null, monthSpan = 0, monthCells = "";
  allWeeks.forEach((w, i) => {
    if (w.month !== currentMonth || w.year !== currentYearForMonth) {
      if (monthSpan > 0)
        monthCells += `<th class="month" colspan="${monthSpan}">${currentMonth}</th>`;
      currentMonth = w.month;
      currentYearForMonth = w.year;
      monthSpan = 1;
    } else monthSpan++;
    if (i === allWeeks.length - 1)
      monthCells += `<th class="month" colspan="${monthSpan}">${currentMonth}</th>`;
  });
  monthRow.innerHTML = monthCells;
  table.appendChild(monthRow);

  // === 3. Satır: Haftalar ===
  const weekRow = document.createElement("tr");
  weekRow.innerHTML = allWeeks.map(w => `<th class="week">w${w.week}</th>`).join("");
  table.appendChild(weekRow);

  // === Tasks Rows ===
  tasks.forEach(task => {
    const row = document.createElement("tr");
    row.innerHTML = `<td class="task-name">${task.name}</td>`;
    allWeeks.forEach(w => {
      const id = `${w.year}-W${w.week}`;
      const td = document.createElement("td");
      if (isBetweenWeeks(id, task.start, task.end)) td.classList.add("bar");
      row.appendChild(td);
    });
    table.appendChild(row);
  });

  function isBetweenWeeks(current, start, end) {
    const order = id => {
      const [y, wk] = id.split("-W");
      return parseInt(y) * 100 + parseInt(wk);
    };
    return order(current) >= order(start) && order(current) <= order(end);
  }
</script>

</body>
</html>
